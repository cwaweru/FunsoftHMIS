/*
 * ReportIntfr.java
 *
 * Created on July 6, 2008, 4:40 PM
 */

package biz.systempartners.reports;

import java.sql.SQLException;
import java.util.logging.Level;
import java.util.logging.Logger;

/**
 *
 * @author  funsoft
 */
public class DepositsStatementView extends javax.swing.JInternalFrame {
   
    java.sql.Connection connectDB = null;
    private String rnamex;
    private String rcodex;
    
    /** Creates new form ReportIntfr */
    public DepositsStatementView(java.sql.Connection connDb) {
        connectDB = connDb;
        initComponents();
      //  loadReport();
        
    }
    
    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        jSearchDialog = new javax.swing.JDialog();
        jSearchPanel = new javax.swing.JPanel();
        jSearchScrollPane = new javax.swing.JScrollPane();
        jSearchTable = new com.afrisoftech.dbadmin.JTable();
        jButton9 = new javax.swing.JButton();
        invoice_no1 = new javax.swing.JTextField();
        headerPanel = new javax.swing.JPanel();
        endDateLbl = new javax.swing.JLabel();
        endDateLbl1 = new javax.swing.JLabel();
        acclabel = new javax.swing.JLabel();
        beginDatePicker = new com.afrisoftech.lib.DatePicker();
        endDatePicker = new com.afrisoftech.lib.DatePicker();
        glAccountCmbx = new javax.swing.JComboBox();
        jLabel4 = new javax.swing.JLabel();
        reportBodyPanel = new javax.swing.JPanel();
        jTabbedPane1 = new javax.swing.JTabbedPane();
        reportBodyJscrollPane = new javax.swing.JScrollPane();
        depositsTableView = new com.afrisoftech.dbadmin.JTable();
        jScrollPane1 = new javax.swing.JScrollPane();
        patientDepositsTable = new com.afrisoftech.dbadmin.JTable();
        buttonPanel = new javax.swing.JPanel();
        closeBtn = new javax.swing.JButton();
        spaceLable = new javax.swing.JLabel();

        jSearchDialog.setModal(true);
        jSearchDialog.setUndecorated(true);
        jSearchDialog.getContentPane().setLayout(new java.awt.GridBagLayout());

        jSearchPanel.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        jSearchPanel.setLayout(new java.awt.GridBagLayout());

        jSearchTable.setShowHorizontalLines(false);
        /*    try {
            searchRowSet.setCommand("select product,selling_price,gl_code FROM st_stock_prices WHERE department = 'Pharmacy' order by product");
            searchRowSet.setConnectionSource(pConnDB);

            searchRowSet.execute();

            // crset2.setExecuteOnLoad(true);
            jSearchTable.setModel(new org.netbeans.lib.sql.models.TableModel(searchRowSet, new org.netbeans.lib.sql.models.TableModel.Column[] {
                new org.netbeans.lib.sql.models.TableModel.Column("product", "Description", false),
                new org.netbeans.lib.sql.models.TableModel.Column("selling_price", "Amount", false),
                new org.netbeans.lib.sql.models.TableModel.Column("gl_code", "Gl_code", false)

            }));
            // jSearchScrollPane.setViewportView(jSearchTable);

        } catch(java.sql.SQLException sqlex){
            javax.swing.JOptionPane.showMessageDialog(this,sqlex.getMessage(),"Error Message!",javax.swing.JOptionPane.ERROR_MESSAGE);

            System.out.println(sqlex.getMessage());
        }
        */
        jSearchTable.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                jSearchTableMouseClicked(evt);
            }
        });
        jSearchScrollPane.setViewportView(jSearchTable);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 20.0;
        jSearchPanel.add(jSearchScrollPane, gridBagConstraints);

        jButton9.setText("Dispose");
        jButton9.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton9ActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.weighty = 1.0;
        jSearchPanel.add(jButton9, gridBagConstraints);

        invoice_no1.addCaretListener(new javax.swing.event.CaretListener() {
            public void caretUpdate(javax.swing.event.CaretEvent evt) {
                invoice_no1CaretUpdate(evt);
            }
        });
        invoice_no1.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                invoice_no1MouseClicked(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 50);
        jSearchPanel.add(invoice_no1, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jSearchDialog.getContentPane().add(jSearchPanel, gridBagConstraints);

        setClosable(true);
        setIconifiable(true);
        setMaximizable(true);
        setResizable(true);
        setTitle("Deposits Report Module");
        try {
            setSelected(true);
        } catch (java.beans.PropertyVetoException e1) {
            e1.printStackTrace();
        }
        setVisible(true);
        getContentPane().setLayout(new java.awt.GridBagLayout());

        headerPanel.setLayout(new java.awt.GridBagLayout());

        endDateLbl.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        endDateLbl.setText("Begin Date");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        headerPanel.add(endDateLbl, gridBagConstraints);

        endDateLbl1.setFont(new java.awt.Font("Tahoma", 1, 14)); // NOI18N
        endDateLbl1.setText("End Date");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 4;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        headerPanel.add(endDateLbl1, gridBagConstraints);

        acclabel.setFont(new java.awt.Font("Tahoma", 0, 16)); // NOI18N
        acclabel.setText("                                               ");
        acclabel.setToolTipText("  ");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 6;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 20);
        headerPanel.add(acclabel, gridBagConstraints);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        headerPanel.add(beginDatePicker, gridBagConstraints);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 5;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        headerPanel.add(endDatePicker, gridBagConstraints);

        glAccountCmbx.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        glAccountCmbx.setModel(com.afrisoftech.lib.ComboBoxModel.ComboBoxModel(connectDB, "select '0select' union SELECT distinct UPPER(activity) FROM pb_activity WHERE category_class ilike 'plid' and activity ilike '%deposit%' EXCEPT select main_service from pb_operating_parameters WHERE category = 'CA'  ORDER BY 1  asc"));
        glAccountCmbx.addItemListener(new java.awt.event.ItemListener() {
            public void itemStateChanged(java.awt.event.ItemEvent evt) {
                glAccountCmbxItemStateChanged(evt);
            }
        });
        glAccountCmbx.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                glAccountCmbxActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 4;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 10, 0, 50);
        headerPanel.add(glAccountCmbx, gridBagConstraints);

        jLabel4.setFont(new java.awt.Font("Tahoma", 1, 11)); // NOI18N
        jLabel4.setForeground(new java.awt.Color(204, 0, 51));
        jLabel4.setText("Revenue Code/Department");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 5, 0, 0);
        headerPanel.add(jLabel4, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        getContentPane().add(headerPanel, gridBagConstraints);

        reportBodyPanel.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createEtchedBorder()));
        reportBodyPanel.setLayout(new java.awt.GridBagLayout());

        depositsTableView.setFont(new java.awt.Font("Arial", 0, 15)); // NOI18N
        depositsTableView.setForeground(new java.awt.Color(0, 0, 255));
        //javax.swing.table.TableColumn hyperlinkEditor = depositsTableView.getColumnModel().getColumn(3);
        //com.afrisoftech.lib.HyperLinkCellEditor hyperlinkCellEditor = new  com.afrisoftech.lib.HyperLinkCellEditor(new org.jdesktop.swingx.JXHyperlink(),depositsTableView);
        //hyperlinkEditor.setCellEditor(hyperlinkCellEditor);
        //jTable1.setRowHeight(30);
        //javax.swing.table.DefaultTableCellRenderer cellRenderer1 = new javax.swing.table.DefaultTableCellRenderer();
        //cellRenderer1.setHorizontalAlignment(cellRenderer1.TRAILING);
        //hyperlinkEditor.setCellRenderer(cellRenderer1);
        depositsTableView.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                depositsTableViewMouseClicked(evt);
            }
        });
        reportBodyJscrollPane.setViewportView(depositsTableView);

        jTabbedPane1.addTab("Deposit List", reportBodyJscrollPane);

        jScrollPane1.setViewportView(patientDepositsTable);

        jTabbedPane1.addTab("Patient Deposit Utilization", jScrollPane1);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        reportBodyPanel.add(jTabbedPane1, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 200.0;
        getContentPane().add(reportBodyPanel, gridBagConstraints);

        buttonPanel.setLayout(new java.awt.GridBagLayout());

        closeBtn.setMnemonic('l');
        closeBtn.setText("Close Reporter");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        buttonPanel.add(closeBtn, gridBagConstraints);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 100.0;
        gridBagConstraints.weighty = 1.0;
        buttonPanel.add(spaceLable, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        getContentPane().add(buttonPanel, gridBagConstraints);

        setBounds(0, 0, 833, 306);
    }// </editor-fold>//GEN-END:initComponents

    private void jSearchTableMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_jSearchTableMouseClicked
 
    }//GEN-LAST:event_jSearchTableMouseClicked

    private void jButton9ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton9ActionPerformed
        jSearchDialog.dispose();         // Add your handling code here:
    }//GEN-LAST:event_jButton9ActionPerformed

    private void invoice_no1CaretUpdate(javax.swing.event.CaretEvent evt) {//GEN-FIRST:event_invoice_no1CaretUpdate
//            if (this.invoice_no1.getCaretPosition() < 0) {
//                System.out.print("Nothing");
//            } else {
//                jSearchTable.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB,""
//                    + "SELECT supplier_name, code as account_no from st_suppliers where supplier_name ILIKE '"+invoice_no1.getText()+"%' order by supplier_name"));
//            
//            jSearchTable.setShowHorizontalLines(false);
//            jSearchScrollPane.setViewportView(jSearchTable);
//
//        }
    }//GEN-LAST:event_invoice_no1CaretUpdate

    private void invoice_no1MouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_invoice_no1MouseClicked
        // TODO add your handling code here:
    }//GEN-LAST:event_invoice_no1MouseClicked

    private void glAccountCmbxItemStateChanged(java.awt.event.ItemEvent evt) {//GEN-FIRST:event_glAccountCmbxItemStateChanged
        this.setCursor(new java.awt.Cursor(java.awt.Cursor.WAIT_CURSOR));
        try {
            java.sql.Statement stm1211x = connectDB.createStatement();
            //    java.sql.ResultSet rse1211x = stm1211x.executeQuery("SELECT activity,code FROM pb_activity WHERE activity_category ilike 'IDP'");
            java.sql.ResultSet rse1211x = stm1211x.executeQuery("SELECT activity,code FROM pb_activity WHERE activity ilike '" + glAccountCmbx.getSelectedItem().toString() + "'");
            while (rse1211x.next()) {
                 rnamex = rse1211x.getObject(1).toString();
                 rcodex = rse1211x.getObject(2).toString();
            }
            
            depositsTableView.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB,"select  patient_no,dealer,sum(credit) as Deposit_Paid,sum(debit) as Deposit_Utilized,sum(credit-debit) as Deposit_Balance,false as Fully_Utilized " +
" from ac_ledger " +
" where reason='Patient deposit' and transaction_type='Unutilized patient deposit' and " +
" date BETWEEN '" + com.afrisoftech.lib.SQLDateFormat.getSQLDate(beginDatePicker.getDate())+ "' AND '" + com.afrisoftech.lib.SQLDateFormat.getSQLDate(endDatePicker.getDate())+ "' " +
" and description='" + rnamex + "' and activity_code='"+rcodex+"' " +
"  group by 1,2 order by 2"));
            for(int i=0;i<depositsTableView.getRowCount();i++){
                if(Double.valueOf(String.valueOf(depositsTableView.getValueAt(i, 4)))==0.00){
                    depositsTableView.setValueAt("true", i, 5);
                }
            }
            
            
            javax.swing.table.TableColumn hyperlinkEditor = depositsTableView.getColumnModel().getColumn(3);
            com.afrisoftech.lib.HyperLinkCellEditor hyperlinkCellEditor = new com.afrisoftech.lib.HyperLinkCellEditor(new org.jdesktop.swingx.JXHyperlink(), depositsTableView);
            hyperlinkEditor.setCellEditor(hyperlinkCellEditor);
            javax.swing.table.DefaultTableCellRenderer cellRenderer1 = new javax.swing.table.DefaultTableCellRenderer();
            cellRenderer1.setHorizontalAlignment(cellRenderer1.TRAILING);
            hyperlinkEditor.setCellRenderer(cellRenderer1);
            
        } catch (SQLException ex) {
            Logger.getLogger(DepositsStatementView.class.getName()).log(Level.SEVERE, null, ex);
        }
            this.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
    }//GEN-LAST:event_glAccountCmbxItemStateChanged

    private void depositsTableViewMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_depositsTableViewMouseClicked
 this.setCursor(new java.awt.Cursor(java.awt.Cursor.WAIT_CURSOR));
        patientDepositsTable.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB,"select  date,patient_no,receipt_no,credit as Deposit_Paid,debit as Deposit_Utilized  " +
" from ac_ledger " +
" where reason='Patient deposit' and transaction_type='Unutilized patient deposit' and " +
" date BETWEEN '" + com.afrisoftech.lib.SQLDateFormat.getSQLDate(beginDatePicker.getDate())+ "' AND '" + com.afrisoftech.lib.SQLDateFormat.getSQLDate(endDatePicker.getDate())+ "' " +
" and patient_no='"+depositsTableView.getValueAt(depositsTableView.getSelectedRow(), 0).toString().trim()+"'  " +
" order by 2"));
            this.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
    }//GEN-LAST:event_depositsTableViewMouseClicked

    private void glAccountCmbxActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_glAccountCmbxActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_glAccountCmbxActionPerformed
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JLabel acclabel;
    private com.afrisoftech.lib.DatePicker beginDatePicker;
    private javax.swing.JPanel buttonPanel;
    private javax.swing.JButton closeBtn;
    public static javax.swing.JTable depositsTableView;
    private javax.swing.JLabel endDateLbl;
    private javax.swing.JLabel endDateLbl1;
    private com.afrisoftech.lib.DatePicker endDatePicker;
    private javax.swing.JComboBox glAccountCmbx;
    private javax.swing.JPanel headerPanel;
    private javax.swing.JTextField invoice_no1;
    private javax.swing.JButton jButton9;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JDialog jSearchDialog;
    private javax.swing.JPanel jSearchPanel;
    private javax.swing.JScrollPane jSearchScrollPane;
    private javax.swing.JTable jSearchTable;
    private javax.swing.JTabbedPane jTabbedPane1;
    private javax.swing.JTable patientDepositsTable;
    public static javax.swing.JScrollPane reportBodyJscrollPane;
    public static javax.swing.JPanel reportBodyPanel;
    private javax.swing.JLabel spaceLable;
    // End of variables declaration//GEN-END:variables
    
}
