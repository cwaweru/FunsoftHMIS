/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.afrisoftech.hospinventory;

/**
 *
 * @author Charles
 */
public class StoresLedgerReportsIntfr extends javax.swing.JInternalFrame {

    java.sql.Connection connectDB = null;

    /**
     * Creates new form StoresLedgerReportsIntfr
     */
    public StoresLedgerReportsIntfr(java.sql.Connection connDB) {
        connectDB = connDB;
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        headerPanel = new javax.swing.JPanel();
        startDatePicker = new com.afrisoftech.lib.DatePicker();
        endDatePicker = new com.afrisoftech.lib.DatePicker();
        bodyPanel = new javax.swing.JPanel();
        storeDashboardTabbedPane = new javax.swing.JTabbedPane();
        StoreBalancesPanel = new javax.swing.JPanel();
        stockValuationScrollPane = new javax.swing.JScrollPane();
        stockValuationTable = new com.afrisoftech.dbadmin.JXTable();
        storeDetailedBalancesPanel = new javax.swing.JPanel();
        storeDetailedBalancesScrollPane = new javax.swing.JScrollPane();
        storeDetailedBalancesTable = new com.afrisoftech.dbadmin.JXTable();
        jComboBox2 = new javax.swing.JComboBox();
        stockAuditTrailPanel = new javax.swing.JPanel();
        storesAuditScrollPane = new javax.swing.JScrollPane();
        storesAuditTrailTable = new com.afrisoftech.dbadmin.JXTable();
        itemBalancesPanel = new javax.swing.JPanel();
        itemBalancesScrollPane = new javax.swing.JScrollPane();
        itemBalancesTable = new com.afrisoftech.dbadmin.JXTable();
        jComboBox1 = new javax.swing.JComboBox();
        buttonPanel = new javax.swing.JPanel();
        generateReportBtn = new javax.swing.JButton();
        refreshReportBtn = new javax.swing.JButton();
        closeFormBtn = new javax.swing.JButton();
        spacerLabel = new javax.swing.JLabel();

        setClosable(true);
        setIconifiable(true);
        setMaximizable(true);
        setResizable(true);
        setTitle("Supply Chain Management Dashboard - Stores Ledger Reports");
        setVisible(true);
        getContentPane().setLayout(new java.awt.GridBagLayout());

        headerPanel.setLayout(new java.awt.GridBagLayout());

        startDatePicker.setBorder(javax.swing.BorderFactory.createTitledBorder(org.openide.util.NbBundle.getMessage(StoresLedgerReportsIntfr.class, "StoresLedgerReportsIntfr.startDatePicker.border.title"))); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        headerPanel.add(startDatePicker, gridBagConstraints);

        endDatePicker.setBorder(javax.swing.BorderFactory.createTitledBorder(org.openide.util.NbBundle.getMessage(StoresLedgerReportsIntfr.class, "StoresLedgerReportsIntfr.endDatePicker.border.title"))); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        headerPanel.add(endDatePicker, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        getContentPane().add(headerPanel, gridBagConstraints);

        bodyPanel.setLayout(new java.awt.GridBagLayout());

        StoreBalancesPanel.setLayout(new java.awt.GridBagLayout());

        stockValuationTable.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB, "SELECT * FROM funsoft_stock_valuation('"+endDatePicker.getDate()+"') ORDER BY 1")
        );
        stockValuationScrollPane.setViewportView(stockValuationTable);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        StoreBalancesPanel.add(stockValuationScrollPane, gridBagConstraints);

        storeDashboardTabbedPane.addTab("Stores Ledger Balances Report", StoreBalancesPanel);

        storeDetailedBalancesPanel.setLayout(new java.awt.GridBagLayout());

        storeDetailedBalancesTable.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB, "SELECT initcap(item) as item_name, sum(debit-quantity_ordered) FROM st_stock_cardex WHERE initcap(store) = '"+jComboBox2.getSelectedItem()+"' GROUP BY 1 ORDER BY 1")
        );
        storeDetailedBalancesScrollPane.setViewportView(storeDetailedBalancesTable);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 200.0;
        storeDetailedBalancesPanel.add(storeDetailedBalancesScrollPane, gridBagConstraints);

        jComboBox2.setModel(com.afrisoftech.lib.ComboBoxModel.ComboBoxModel(connectDB, "SELECT DISTINCT initcap(store_name) FROM st_stores WHERE patient_store = false ORDER BY 1")
        );
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        storeDetailedBalancesPanel.add(jComboBox2, gridBagConstraints);

        storeDashboardTabbedPane.addTab("Detailed Store Balances Report", storeDetailedBalancesPanel);

        stockAuditTrailPanel.setLayout(new java.awt.GridBagLayout());

        storesAuditTrailTable.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB, "SELECT initcap(store) as store_name, initcap(item) as item_name, quantity_received, debit as value_received, sub_store_issuing as issued_qty, quantity_ordered as value_issued, data_capture_time, user_name FROM st_stock_cardex WHERE data_capture_time::date between '"+startDatePicker.getDate()+"' AND '"+endDatePicker.getDate()+"' ORDER BY data_capture_time")
        );
        storesAuditScrollPane.setViewportView(storesAuditTrailTable);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        stockAuditTrailPanel.add(storesAuditScrollPane, gridBagConstraints);

        storeDashboardTabbedPane.addTab("Stock Movement Audit Trail", stockAuditTrailPanel);

        itemBalancesPanel.setLayout(new java.awt.GridBagLayout());

        itemBalancesTable.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB, "SELECT store, sum(debit-quantity_ordered) FROM st_stock_cardex WHERE initcap(item) = '"+jComboBox1.getSelectedItem()+"' GROUP BY 1 ORDER BY 1")
        );
        itemBalancesScrollPane.setViewportView(itemBalancesTable);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 200.0;
        itemBalancesPanel.add(itemBalancesScrollPane, gridBagConstraints);

        jComboBox1.setModel(com.afrisoftech.lib.ComboBoxModel.ComboBoxModel(connectDB, "SELECT DISTINCT initcap(description) FROM st_stock_item ORDER BY 1")
        );
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        itemBalancesPanel.add(jComboBox1, gridBagConstraints);

        storeDashboardTabbedPane.addTab("Stock Item Balances Per Store Report", itemBalancesPanel);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        bodyPanel.add(storeDashboardTabbedPane, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 500.0;
        getContentPane().add(bodyPanel, gridBagConstraints);

        buttonPanel.setLayout(new java.awt.GridBagLayout());

        org.openide.awt.Mnemonics.setLocalizedText(generateReportBtn, "Generate Report");
        generateReportBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                generateReportBtnActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        buttonPanel.add(generateReportBtn, gridBagConstraints);

        org.openide.awt.Mnemonics.setLocalizedText(refreshReportBtn, "Refresh Report");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        buttonPanel.add(refreshReportBtn, gridBagConstraints);

        org.openide.awt.Mnemonics.setLocalizedText(closeFormBtn, "Close form");
        closeFormBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                closeFormBtnActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        buttonPanel.add(closeFormBtn, gridBagConstraints);

        org.openide.awt.Mnemonics.setLocalizedText(spacerLabel, org.openide.util.NbBundle.getMessage(StoresLedgerReportsIntfr.class, "StoresLedgerReportsIntfr.spacerLabel.text")); // NOI18N
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 200.0;
        gridBagConstraints.weighty = 1.0;
        buttonPanel.add(spacerLabel, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        getContentPane().add(buttonPanel, gridBagConstraints);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void closeFormBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_closeFormBtnActionPerformed

        this.dispose();

// TODO add your handling code here:
    }//GEN-LAST:event_closeFormBtnActionPerformed

    private void generateReportBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_generateReportBtnActionPerformed
        this.setCursor(new java.awt.Cursor(java.awt.Cursor.WAIT_CURSOR));
        storeDetailedBalancesTable.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB, "SELECT initcap(item) as item_name, sum(debit-quantity_ordered) FROM st_stock_cardex WHERE initcap(store) = '" + jComboBox2.getSelectedItem() + "' GROUP BY 1 ORDER BY 1"));
        storesAuditTrailTable.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB, "SELECT initcap(store) as store_name, initcap(item) as item_name, quantity_received, debit as value_received, sub_store_issuing as issued_qty, quantity_ordered as value_issued, data_capture_time, user_name FROM st_stock_cardex WHERE data_capture_time::date between '" + startDatePicker.getDate() + "' AND '" + endDatePicker.getDate() + "' ORDER BY data_capture_time"));
        itemBalancesTable.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB, "SELECT store, sum(debit-quantity_ordered) FROM st_stock_cardex WHERE initcap(item) = '" + jComboBox1.getSelectedItem() + "' GROUP BY 1 ORDER BY 1"));
        stockValuationTable.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB, "SELECT * FROM funsoft_stock_valuation('" + endDatePicker.getDate() + "') ORDER BY 1"));
        this.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
// TODO add your handling code here:
    }//GEN-LAST:event_generateReportBtnActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel StoreBalancesPanel;
    private javax.swing.JPanel bodyPanel;
    private javax.swing.JPanel buttonPanel;
    private javax.swing.JButton closeFormBtn;
    private com.afrisoftech.lib.DatePicker endDatePicker;
    private javax.swing.JButton generateReportBtn;
    private javax.swing.JPanel headerPanel;
    private javax.swing.JPanel itemBalancesPanel;
    private javax.swing.JScrollPane itemBalancesScrollPane;
    private javax.swing.JTable itemBalancesTable;
    private javax.swing.JComboBox jComboBox1;
    private javax.swing.JComboBox jComboBox2;
    private javax.swing.JButton refreshReportBtn;
    private javax.swing.JLabel spacerLabel;
    private com.afrisoftech.lib.DatePicker startDatePicker;
    private javax.swing.JPanel stockAuditTrailPanel;
    private javax.swing.JScrollPane stockValuationScrollPane;
    private javax.swing.JTable stockValuationTable;
    private javax.swing.JTabbedPane storeDashboardTabbedPane;
    private javax.swing.JPanel storeDetailedBalancesPanel;
    private javax.swing.JScrollPane storeDetailedBalancesScrollPane;
    private javax.swing.JTable storeDetailedBalancesTable;
    private javax.swing.JScrollPane storesAuditScrollPane;
    private javax.swing.JTable storesAuditTrailTable;
    // End of variables declaration//GEN-END:variables
}
