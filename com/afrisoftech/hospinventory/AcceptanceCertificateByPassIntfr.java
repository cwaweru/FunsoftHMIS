/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package com.afrisoftech.hospinventory;

import java.sql.SQLException;
//import org.openide.util.Exceptions;

/**
 *
 * @author Charles
 */
public class AcceptanceCertificateByPassIntfr extends javax.swing.JInternalFrame {

    java.sql.Connection connectDB = null;

    /**
     * Creates new form AcceptanceCertificateByPassIntfr
     */
    public AcceptanceCertificateByPassIntfr(java.sql.Connection connDB) {

        connectDB = connDB;

        initComponents();

    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        lpoSearchDialog = new javax.swing.JDialog();
        lpoSearchPanel = new javax.swing.JPanel();
        searchLPOTxt = new javax.swing.JTextField();
        lpoSearchScrollPane = new javax.swing.JScrollPane();
        lpoSearchTable = new com.afrisoftech.dbadmin.JXTable();
        searchCloseBtn = new javax.swing.JButton();
        jPanel1 = new javax.swing.JPanel();
        supplierNameTxt = new javax.swing.JTextField();
        deliveryDatePicker = new com.afrisoftech.lib.DatePicker();
        searchPanel = new javax.swing.JPanel();
        lpoNumberTxt = new javax.swing.JTextField();
        searchButton = new javax.swing.JButton();
        lpoSupplierLbl = new javax.swing.JLabel();
        lpoScrollPane = new javax.swing.JScrollPane();
        lpoDetailsTable = new com.afrisoftech.dbadmin.JXTable();
        actionsPanel = new javax.swing.JPanel();
        confirmAcceptanceBtn = new javax.swing.JButton();
        closeBtn = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();

        lpoSearchDialog.setModal(true);
        lpoSearchDialog.setUndecorated(true);
        lpoSearchDialog.getContentPane().setLayout(new java.awt.GridBagLayout());

        lpoSearchPanel.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        lpoSearchPanel.setLayout(new java.awt.GridBagLayout());

        searchLPOTxt.addCaretListener(new javax.swing.event.CaretListener() {
            public void caretUpdate(javax.swing.event.CaretEvent evt) {
                searchLPOTxtCaretUpdate(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 300.0;
        gridBagConstraints.weighty = 1.0;
        gridBagConstraints.insets = new java.awt.Insets(0, 0, 0, 5);
        lpoSearchPanel.add(searchLPOTxt, gridBagConstraints);

        lpoSearchTable.setToolTipText("Click on the target row to select the patient from the search.");
        lpoSearchTable.setShowHorizontalLines(false);
        /*javax.swing.table.TableColumn column = null;

        for (int i = 0; i < 4; i++) {

            column = jSearchTable2.getColumnModel().getColumn(i);

            if (i == 1) {

                column.setPreferredWidth(400);
                //sport column is bigger
            } else {

                column.setPreferredWidth(200);

            }
        }
        */
        lpoSearchTable.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                lpoSearchTableMouseClicked(evt);
            }
        });
        lpoSearchScrollPane.setViewportView(lpoSearchTable);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 20.0;
        lpoSearchPanel.add(lpoSearchScrollPane, gridBagConstraints);

        searchCloseBtn.setText("Close");
        searchCloseBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                searchCloseBtnActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        lpoSearchPanel.add(searchCloseBtn, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        lpoSearchDialog.getContentPane().add(lpoSearchPanel, gridBagConstraints);

        setClosable(true);
        setIconifiable(true);
        setMaximizable(true);
        setResizable(true);
        setTitle("By Pass for Acceptance Certificate");
        getContentPane().setLayout(new java.awt.GridBagLayout());

        jPanel1.setLayout(new java.awt.GridBagLayout());

        supplierNameTxt.setEditable(false);
        supplierNameTxt.setBorder(javax.swing.BorderFactory.createTitledBorder("Supplier Name"));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        jPanel1.add(supplierNameTxt, gridBagConstraints);

        deliveryDatePicker.setBorder(javax.swing.BorderFactory.createTitledBorder("Delivery Date"));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        jPanel1.add(deliveryDatePicker, gridBagConstraints);

        searchPanel.setBorder(javax.swing.BorderFactory.createEtchedBorder());
        searchPanel.setLayout(new java.awt.GridBagLayout());

        lpoNumberTxt.setEditable(false);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        searchPanel.add(lpoNumberTxt, gridBagConstraints);

        searchButton.setIcon(new javax.swing.ImageIcon(getClass().getResource("/kiwi/images/date.gif"))); // NOI18N
        searchButton.setToolTipText("Search");
        searchButton.setHorizontalAlignment(javax.swing.SwingConstants.TRAILING);
        searchButton.setMaximumSize(new java.awt.Dimension(74, 53));
        searchButton.setMinimumSize(new java.awt.Dimension(74, 53));
        searchButton.setVerticalTextPosition(javax.swing.SwingConstants.BOTTOM);
        searchButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                searchButtonActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 2;
        searchPanel.add(searchButton, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        jPanel1.add(searchPanel, gridBagConstraints);

        lpoSupplierLbl.setText("Search by LPO or Supplier Name :");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
        jPanel1.add(lpoSupplierLbl, gridBagConstraints);

        lpoDetailsTable.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {

            },
            new String [] {

            }
        ));
        lpoScrollPane.setViewportView(lpoDetailsTable);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 4;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 100.0;
        jPanel1.add(lpoScrollPane, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 200.0;
        getContentPane().add(jPanel1, gridBagConstraints);

        actionsPanel.setLayout(new java.awt.GridBagLayout());

        confirmAcceptanceBtn.setText("Confirm Acceptance");
        confirmAcceptanceBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                confirmAcceptanceBtnActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        actionsPanel.add(confirmAcceptanceBtn, gridBagConstraints);

        closeBtn.setText("Close form");
        closeBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                closeBtnActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 4;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        actionsPanel.add(closeBtn, gridBagConstraints);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.gridwidth = 3;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 300.0;
        gridBagConstraints.weighty = 1.0;
        actionsPanel.add(jLabel1, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.gridwidth = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        getContentPane().add(actionsPanel, gridBagConstraints);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void searchButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_searchButtonActionPerformed
        searchButton21Clicked(); // Add your handling code here:
    }//GEN-LAST:event_searchButtonActionPerformed

    private void closeBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_closeBtnActionPerformed

        this.dispose();// TODO add your handling code here:
    }//GEN-LAST:event_closeBtnActionPerformed

    private void searchLPOTxtCaretUpdate(javax.swing.event.CaretEvent evt) {//GEN-FIRST:event_searchLPOTxtCaretUpdate
        if (searchLPOTxt.getText().length() > 2) {
            lpoSearchTable.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB, "select order_no, date::date, supplier, grn_no, sum(debit-credit) as order_value FROM st_stock_cardex where (order_no ILIKE '%" + searchLPOTxt.getText() + "%' or supplier ilike '%" + searchLPOTxt.getText() + "%') AND order_no is not null AND chairperson = false group by 1,2,3,4 having sum(debit-credit) > 0 order by 1"));

            lpoSearchScrollPane.setViewportView(lpoSearchTable);
        }
     //   System.out.println("Cannot sort out");

        // Add your handling code here:
    }//GEN-LAST:event_searchLPOTxtCaretUpdate

    private void lpoSearchTableMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_lpoSearchTableMouseClicked

        lpoNumberTxt.setText(lpoSearchTable.getValueAt(lpoSearchTable.getSelectedRow(), 0).toString());
        supplierNameTxt.setText(lpoSearchTable.getValueAt(lpoSearchTable.getSelectedRow(), 2).toString());
        lpoDetailsTable.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB, "SELECT upper(store), item, units, quantity_received, debit as value_amount, invoice_no, grn_no, user_name as person_receiving_items, false as approve FROM st_stock_cardex WHERE order_no = '" + lpoNumberTxt.getText() + "'  AND certficate_no is null group by 1,2,3,4,5,6,7,8 having sum(debit-quantity_ordered) > 0 ORDER BY grn_no"));
        lpoSearchDialog.dispose();   // Add your handling code here:
    }//GEN-LAST:event_lpoSearchTableMouseClicked

    private void searchCloseBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_searchCloseBtnActionPerformed
        lpoSearchDialog.dispose();      // Add your handling code here:
    }//GEN-LAST:event_searchCloseBtnActionPerformed

    private void confirmAcceptanceBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_confirmAcceptanceBtnActionPerformed

        try {
            java.sql.PreparedStatement pstmt = null;
            for (int i = 0; i < lpoDetailsTable.getRowCount(); i++) {
                if (Boolean.parseBoolean(lpoDetailsTable.getValueAt(i, 8).toString()) == Boolean.TRUE) {
                    pstmt = connectDB.prepareStatement("UPDATE st_stock_cardex SET technical = true, technical_name = ?, supplies = true, supplies_name = ?, chairperson_name = ?, chair_remarks = ?, chairperson_date = ?, chairperson = true, certficate_no = '-' WHERE order_no = ? AND grn_no = ?");

                    pstmt.setString(1, com.afrisoftech.lib.UserName.getLoginName(connectDB));
                    pstmt.setString(2, com.afrisoftech.lib.UserName.getLoginName(connectDB));
                    pstmt.setString(3, com.afrisoftech.lib.UserName.getLoginName(connectDB));
                    pstmt.setString(4, "ACCEPTANCE CERTIFICATE BY_PASSED");
                    pstmt.setTimestamp(5, com.afrisoftech.lib.ServerTime.getSQLTimeStamp(connectDB));
                    pstmt.setString(6, lpoNumberTxt.getText());
                    pstmt.setString(7, lpoDetailsTable.getValueAt(i, 6).toString());
                    pstmt.executeUpdate();
                }
                pstmt.close();
            }
            javax.swing.JOptionPane.showMessageDialog(this, "Acceptance certificate by-pass successful");
        } catch (java.sql.SQLException sq) {
            sq.printStackTrace();
            javax.swing.JOptionPane.showMessageDialog(this, sq.getMessage());
        }
        // TODO add your handling code here:
    }//GEN-LAST:event_confirmAcceptanceBtnActionPerformed
    private void searchButton21Clicked() {

        System.out.println("Showing dialog");

        java.awt.Point point = this.lpoNumberTxt.getLocationOnScreen();

        lpoSearchDialog.setSize(600, 200);

        lpoSearchDialog.setLocation(point);

        lpoSearchDialog.setVisible(true);
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JPanel actionsPanel;
    private javax.swing.JButton closeBtn;
    private javax.swing.JButton confirmAcceptanceBtn;
    private com.afrisoftech.lib.DatePicker deliveryDatePicker;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JTable lpoDetailsTable;
    private javax.swing.JTextField lpoNumberTxt;
    private javax.swing.JScrollPane lpoScrollPane;
    private javax.swing.JDialog lpoSearchDialog;
    private javax.swing.JPanel lpoSearchPanel;
    private javax.swing.JScrollPane lpoSearchScrollPane;
    private javax.swing.JTable lpoSearchTable;
    private javax.swing.JLabel lpoSupplierLbl;
    private javax.swing.JButton searchButton;
    private javax.swing.JButton searchCloseBtn;
    private javax.swing.JTextField searchLPOTxt;
    private javax.swing.JPanel searchPanel;
    private javax.swing.JTextField supplierNameTxt;
    // End of variables declaration//GEN-END:variables
}
