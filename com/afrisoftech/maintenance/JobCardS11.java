/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package com.afrisoftech.maintenance;

/**
 *
 * @author maina
 */
public class JobCardS11 extends javax.swing.JInternalFrame {

    private org.netbeans.lib.sql.pool.PooledConnectionSource pConnDB=null;
    private java.sql.Connection connectDB=null;
    private javax.swing.JDesktopPane desktopPane=null;
    
    private String userName=null;
    private String sectionAllocated=null;
    /**
     * Creates new form JobCardDetailsNew
     */
    public JobCardS11( java.sql.Connection conn, org.netbeans.lib.sql.pool.PooledConnectionSource pConn,javax.swing.JDesktopPane desktopP) {
        
        pConnDB=pConn;
        connectDB=conn;
        desktopPane=desktopP;
        
        
        try{
            java.sql.Statement userStat=connectDB.createStatement();
            java.sql.ResultSet userSet=userStat.executeQuery("SELECT current_user");
            
            while(userSet.next()){
                userName=userSet.getString(1);
            }
            
            System.err.println("username = "+userName);
            
            java.sql.Statement sectStat=connectDB.createStatement();
            java.sql.ResultSet sectSet=userStat.executeQuery("SELECT section FROM  maintenance.section_allocation WHERE user_name='"+userName+"' ORDER BY row_id DESC LIMIT 1");
            
            while(sectSet.next()){
                sectionAllocated=sectSet.getString(1);
            }
            
            System.err.println("section = "+sectionAllocated);
            
        }catch(java.sql.SQLException sqle){
            sqle.printStackTrace();
        }
        
        if(!(sectionAllocated==null)){
            initComponents();
        }else{
            javax.swing.JOptionPane.showMessageDialog(this, "Please ensure your username has been registered under at least one Maintenance Section",
                    "Unauthorized Access Attempt!",
                    javax.swing.JOptionPane.ERROR_MESSAGE);
        }
        
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        jButton1 = new javax.swing.JButton();
        deptRadiosbuttonGroup = new javax.swing.ButtonGroup();
        jPanel1 = new javax.swing.JPanel();
        tabbedPane = new javax.swing.JTabbedPane();
        jobCardS11jPanel = new javax.swing.JPanel();
        tablePanel = new javax.swing.JPanel();
        jScrollPane3 = new javax.swing.JScrollPane();
        s11jTable = new javax.swing.JTable();
        withS11ActionjPanel = new javax.swing.JPanel();
        saveS11jButton = new javax.swing.JButton();
        clearS11jButton = new javax.swing.JButton();
        malizaBilajButton = new javax.swing.JButton();
        filler7 = new javax.swing.Box.Filler(new java.awt.Dimension(0, 0), new java.awt.Dimension(0, 0), new java.awt.Dimension(32767, 32767));
        filler8 = new javax.swing.Box.Filler(new java.awt.Dimension(0, 0), new java.awt.Dimension(0, 0), new java.awt.Dimension(32767, 32767));
        filler9 = new javax.swing.Box.Filler(new java.awt.Dimension(0, 0), new java.awt.Dimension(0, 0), new java.awt.Dimension(32767, 32767));
        filler10 = new javax.swing.Box.Filler(new java.awt.Dimension(0, 0), new java.awt.Dimension(0, 0), new java.awt.Dimension(32767, 32767));
        jobCardS11DetailsjPanel = new javax.swing.JPanel();
        jLabel11 = new javax.swing.JLabel();
        jLabel12 = new javax.swing.JLabel();
        jLabel13 = new javax.swing.JLabel();
        jLabel14 = new javax.swing.JLabel();
        jLabel15 = new javax.swing.JLabel();
        jLabel16 = new javax.swing.JLabel();
        deptS11jTextField = new javax.swing.JTextField();
        floorS11jTextField = new javax.swing.JTextField();
        subjectS11jTextField = new javax.swing.JTextField();
        buildingS11jTextField = new javax.swing.JTextField();
        roomS11jTextField = new javax.swing.JTextField();
        jLabel17 = new javax.swing.JLabel();
        jLabel18 = new javax.swing.JLabel();
        officialNamesS11jTextField = new javax.swing.JTextField();
        durationS11jTextField = new javax.swing.JTextField();
        jScrollPane4 = new javax.swing.JScrollPane();
        descS11jTextArea = new javax.swing.JTextArea();
        jLabel19 = new javax.swing.JLabel();
        jobCardS11TextField = new javax.swing.JTextField();
        filler4 = new javax.swing.Box.Filler(new java.awt.Dimension(0, 0), new java.awt.Dimension(20, 67), new java.awt.Dimension(32767, 32767));

        jButton1.setText("jButton1");

        setClosable(true);
        setIconifiable(true);
        setMaximizable(true);
        setResizable(true);
        setTitle("Job Card S11 - "+sectionAllocated);
        setMaximumSize(new java.awt.Dimension(1000, 900));
        setMinimumSize(new java.awt.Dimension(450, 400));
        setVisible(true);
        getContentPane().setLayout(new java.awt.GridBagLayout());

        jPanel1.setBorder(javax.swing.BorderFactory.createEtchedBorder(javax.swing.border.EtchedBorder.RAISED));
        jPanel1.setLayout(new java.awt.GridBagLayout());

        tabbedPane.setBorder(javax.swing.BorderFactory.createMatteBorder(1, 1, 1, 1, java.awt.Color.darkGray));

        jobCardS11jPanel.setBorder(javax.swing.BorderFactory.createEtchedBorder(javax.swing.border.EtchedBorder.RAISED));
        jobCardS11jPanel.setLayout(new java.awt.GridBagLayout());

        tablePanel.setLayout(new java.awt.GridBagLayout());

        s11jTable = new com.afrisoftech.dbadmin.JTable();
        s11jTable.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {},
                {},
                {},
                {}
            },
            new String [] {

            }
        ));
        s11jTable.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null,null,null,null,null,null,null},
                {null,null,null,null,null,null,null},
                {null,null,null,null,null,null,null},
                {null,null,null,null,null,null,null},
                {null,null,null,null,null,null,null},
                {null,null,null,null,null,null,null},
                {null,null,null,null,null,null,null},
                {null,null,null,null,null,null,null},
                {null,null,null,null,null,null,null},
                {null,null,null,null,null,null,null},
                {null,null,null,null,null,null,null},
                {null,null,null,null,null,null,null},
                {null,null,null,null,null,null,null},
                {null,null,null,null,null,null,null},
                {null,null,null,null,null,null,null}

            },

            new String[] {"Job Card ID","Department","Floor","Room","Subject","Official's Name"}

        )
    );

    //the table's model will only populate when the E1 has been approved AND when it has been registered.

    //jTable1.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB, SELECT (SELECT job_card_no FROM maintenance.job_card_details WHERE e1_id='E14'),e1_id,department,floor,room,subject,(SELECT officers_assigned FROM maintenance.job_card_details WHERE e1_id='E14') FROM maintenance.e1_details
        //where e1_id='E14'
        //AND e1_id IN (SELECT e1_id FROM maintenance.e1_approved)
        //AND e1_id IN (SELECT e1_id FROM maintenance.e1_details WHERE registered='true'));

    s11jTable.setModel(s11TableDataModel("%"));

    s11jTable.getTableHeader().setReorderingAllowed(false);

    javax.swing.JTextField s11NoCellEdit=new javax.swing.JTextField();
    s11NoCellEdit.setEditable(false);

    for(int c=0;c<s11jTable.getColumnCount();c++){
        javax.swing.table.TableColumn tcS11 = s11jTable.getColumn(s11jTable.getColumnName(c));
        tcS11.setCellEditor(new javax.swing.DefaultCellEditor(s11NoCellEdit));
    }
    s11jTable.addMouseListener(new java.awt.event.MouseAdapter() {
        public void mouseClicked(java.awt.event.MouseEvent evt) {
            s11jTableMouseClicked(evt);
        }
    });
    jScrollPane3.setViewportView(s11jTable);

    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 1;
    gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
    gridBagConstraints.weightx = 1.0;
    gridBagConstraints.weighty = 1.0;
    tablePanel.add(jScrollPane3, gridBagConstraints);

    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 0;
    gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
    gridBagConstraints.weightx = 1.0;
    gridBagConstraints.weighty = 1.0;
    gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
    jobCardS11jPanel.add(tablePanel, gridBagConstraints);

    withS11ActionjPanel.setLayout(new java.awt.GridBagLayout());

    saveS11jButton.setText("Create Job Card S11");
    saveS11jButton.setEnabled(false);
    saveS11jButton.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            saveS11jButtonActionPerformed(evt);
        }
    });
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 2;
    gridBagConstraints.gridy = 0;
    gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
    withS11ActionjPanel.add(saveS11jButton, gridBagConstraints);

    clearS11jButton.setText("Clear Fields/Refresh Table");
    clearS11jButton.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            clearS11jButtonActionPerformed(evt);
        }
    });
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 4;
    gridBagConstraints.gridy = 0;
    gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
    withS11ActionjPanel.add(clearS11jButton, gridBagConstraints);

    malizaBilajButton.setText("Complete Job Card Without S11");
    malizaBilajButton.addActionListener(new java.awt.event.ActionListener() {
        public void actionPerformed(java.awt.event.ActionEvent evt) {
            malizaBilajButtonActionPerformed(evt);
        }
    });
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 6;
    gridBagConstraints.gridy = 0;
    gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
    withS11ActionjPanel.add(malizaBilajButton, gridBagConstraints);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 0;
    gridBagConstraints.gridwidth = 2;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.weightx = 1.0;
    withS11ActionjPanel.add(filler7, gridBagConstraints);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 3;
    gridBagConstraints.gridy = 0;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.weightx = 1.0;
    withS11ActionjPanel.add(filler8, gridBagConstraints);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 5;
    gridBagConstraints.gridy = 0;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.weightx = 1.0;
    withS11ActionjPanel.add(filler9, gridBagConstraints);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 7;
    gridBagConstraints.gridy = 0;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.weightx = 1.0;
    withS11ActionjPanel.add(filler10, gridBagConstraints);

    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 2;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    jobCardS11jPanel.add(withS11ActionjPanel, gridBagConstraints);

    jobCardS11DetailsjPanel.setBorder(javax.swing.BorderFactory.createTitledBorder("top"));
    jobCardS11DetailsjPanel.setLayout(new java.awt.GridBagLayout());

    jLabel11.setText("Department");
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 1;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
    gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
    jobCardS11DetailsjPanel.add(jLabel11, gridBagConstraints);

    jLabel12.setText("Floor");
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 2;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
    gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
    jobCardS11DetailsjPanel.add(jLabel12, gridBagConstraints);

    jLabel13.setText("Subject");
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 4;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
    gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
    jobCardS11DetailsjPanel.add(jLabel13, gridBagConstraints);

    jLabel14.setText("Building");
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 2;
    gridBagConstraints.gridy = 1;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
    gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
    jobCardS11DetailsjPanel.add(jLabel14, gridBagConstraints);

    jLabel15.setText("Room");
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 2;
    gridBagConstraints.gridy = 2;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
    gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
    jobCardS11DetailsjPanel.add(jLabel15, gridBagConstraints);

    jLabel16.setText("E1 Description");
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 6;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
    gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
    jobCardS11DetailsjPanel.add(jLabel16, gridBagConstraints);

    deptS11jTextField.setEditable(false);
    deptS11jTextField.setColumns(10);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 1;
    gridBagConstraints.gridy = 1;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.weightx = 1.0;
    jobCardS11DetailsjPanel.add(deptS11jTextField, gridBagConstraints);

    floorS11jTextField.setEditable(false);
    floorS11jTextField.setColumns(10);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 1;
    gridBagConstraints.gridy = 2;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.weightx = 1.0;
    jobCardS11DetailsjPanel.add(floorS11jTextField, gridBagConstraints);

    subjectS11jTextField.setEditable(false);
    subjectS11jTextField.setColumns(10);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 1;
    gridBagConstraints.gridy = 4;
    gridBagConstraints.gridwidth = 3;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.weightx = 1.0;
    jobCardS11DetailsjPanel.add(subjectS11jTextField, gridBagConstraints);

    buildingS11jTextField.setEditable(false);
    buildingS11jTextField.setColumns(10);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 3;
    gridBagConstraints.gridy = 1;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.weightx = 1.0;
    jobCardS11DetailsjPanel.add(buildingS11jTextField, gridBagConstraints);

    roomS11jTextField.setEditable(false);
    roomS11jTextField.setColumns(10);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 3;
    gridBagConstraints.gridy = 2;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.weightx = 1.0;
    jobCardS11DetailsjPanel.add(roomS11jTextField, gridBagConstraints);

    jLabel17.setText("Official Name(s)");
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 8;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
    gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
    jobCardS11DetailsjPanel.add(jLabel17, gridBagConstraints);

    jLabel18.setText("Expected Duration");
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 10;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
    gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
    jobCardS11DetailsjPanel.add(jLabel18, gridBagConstraints);

    officialNamesS11jTextField.setEditable(false);
    officialNamesS11jTextField.setColumns(10);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 1;
    gridBagConstraints.gridy = 8;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.weightx = 1.0;
    jobCardS11DetailsjPanel.add(officialNamesS11jTextField, gridBagConstraints);

    durationS11jTextField.setEditable(false);
    durationS11jTextField.setColumns(10);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 1;
    gridBagConstraints.gridy = 10;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.weightx = 1.0;
    jobCardS11DetailsjPanel.add(durationS11jTextField, gridBagConstraints);

    descS11jTextArea.setEditable(false);
    descS11jTextArea.setColumns(20);
    descS11jTextArea.setRows(5);
    jScrollPane4.setViewportView(descS11jTextArea);

    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 1;
    gridBagConstraints.gridy = 6;
    gridBagConstraints.gridwidth = 3;
    gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
    gridBagConstraints.weightx = 1.0;
    gridBagConstraints.weighty = 1.0;
    jobCardS11DetailsjPanel.add(jScrollPane4, gridBagConstraints);

    jLabel19.setText("Job Card No.");
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 0;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
    gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
    jobCardS11DetailsjPanel.add(jLabel19, gridBagConstraints);

    jobCardS11TextField.setEditable(false);
    jobCardS11TextField.setColumns(20);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 1;
    gridBagConstraints.gridy = 0;
    gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
    gridBagConstraints.anchor = java.awt.GridBagConstraints.WEST;
    jobCardS11DetailsjPanel.add(jobCardS11TextField, gridBagConstraints);
    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 1;
    gridBagConstraints.gridy = 5;
    gridBagConstraints.gridwidth = 4;
    gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
    gridBagConstraints.weighty = 1.0;
    jobCardS11DetailsjPanel.add(filler4, gridBagConstraints);

    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 1;
    gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
    gridBagConstraints.weightx = 1.0;
    jobCardS11jPanel.add(jobCardS11DetailsjPanel, gridBagConstraints);

    tabbedPane.addTab("Job Card S11 Options", jobCardS11jPanel);

    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 1;
    gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
    gridBagConstraints.weightx = 1.0;
    gridBagConstraints.weighty = 1.0;
    gridBagConstraints.insets = new java.awt.Insets(0, 12, 0, 0);
    jPanel1.add(tabbedPane, gridBagConstraints);

    gridBagConstraints = new java.awt.GridBagConstraints();
    gridBagConstraints.gridx = 0;
    gridBagConstraints.gridy = 0;
    gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
    gridBagConstraints.ipadx = 100;
    gridBagConstraints.ipady = 100;
    gridBagConstraints.weightx = 1.0;
    gridBagConstraints.weighty = 1.0;
    getContentPane().add(jPanel1, gridBagConstraints);

    pack();
    }// </editor-fold>//GEN-END:initComponents

    private void s11jTableMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_s11jTableMouseClicked
        // TODO add your handling code here:
        int row=s11jTable.getSelectedRow();
        
        jobCardS11TextField.setText(s11jTable.getValueAt(row, 0).toString());
        deptS11jTextField.setText(s11jTable.getValueAt(row, 1).toString());
        
        try{
            java.sql.Statement buildDescStt=connectDB.createStatement();
            java.sql.ResultSet buildDescRSet=buildDescStt.executeQuery("SELECT building,description,jc.expected_duration FROM maintenance.e1_details ed "
                                                                                       +"INNER JOIN maintenance.job_card_details jc ON ed.e1_id=jc.e1_id "
                                                                                       +"WHERE ed.e1_id IN (SELECT e1_id FROM maintenance.e1_approved) "
                                                                                        +"AND jc.job_card_no='"+jobCardS11TextField.getText()+"'");
            while(buildDescRSet.next()){
                buildingS11jTextField.setText(buildDescRSet.getString(1));
                descS11jTextArea.setText(buildDescRSet.getString(2));
                durationS11jTextField.setText(buildDescRSet.getString(3));
            }
            
        }
        catch(java.sql.SQLException sqle){
            sqle.printStackTrace();
        }
       
        floorS11jTextField.setText(s11jTable.getValueAt(row, 2).toString());
        subjectS11jTextField.setText(s11jTable.getValueAt(row, 4).toString());
        roomS11jTextField.setText(s11jTable.getValueAt(row, 3).toString());
        officialNamesS11jTextField.setText(s11jTable.getValueAt(row, 5).toString());
        saveS11jButton.setEnabled(true);
        
    }//GEN-LAST:event_s11jTableMouseClicked

    private void saveS11jButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveS11jButtonActionPerformed
        // TODO add your handling code here:
        try{
            
            connectDB.setAutoCommit(false);
            
            java.sql.PreparedStatement ps=connectDB.prepareStatement("UPDATE maintenance.job_card_details SET with_S11=? WHERE job_card_no='"+jobCardS11TextField.getText()+"'");
            ps.setBoolean(1, true);
            ps.executeUpdate();
            
            com.afrisoftech.maintenance.JobCardS11Request s11Req = new com.afrisoftech.maintenance.JobCardS11Request(connectDB, pConnDB,deptS11jTextField.getText(),jobCardS11TextField.getText(),clearS11jButton);
            desktopPane.add(s11Req, javax.swing.JLayeredPane.DEFAULT_LAYER);
            s11Req.setSelected(true);
            s11Req.setSize(s11Req.getSize());
            s11Req.setVisible(true);
            
            connectDB.commit();
            connectDB.setAutoCommit(true);
            
        }
        catch(java.sql.SQLException sqle){
            sqle.printStackTrace();
            
            try{
                connectDB.rollback();
                connectDB.setAutoCommit(true);
            }
            catch(java.sql.SQLException sqlex){
                sqlex.printStackTrace();
            }
        }
        catch (java.beans.PropertyVetoException pvt) {
        }
        
    }//GEN-LAST:event_saveS11jButtonActionPerformed

    private void clearS11jButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_clearS11jButtonActionPerformed
        // TODO add your handling code here:
        jobCardS11TextField.setText("");
        deptS11jTextField.setText("");
        buildingS11jTextField.setText("");
        floorS11jTextField.setText("");
        roomS11jTextField.setText("");
        subjectS11jTextField.setText("");
        durationS11jTextField.setText("");
        officialNamesS11jTextField.setText("");
        descS11jTextArea.setText("");
        deptRadiosbuttonGroup.clearSelection();
        
         //refreshS11Table
        javax.swing.table.DefaultTableModel dtm=s11TableDataModel("%");
        dtm.fireTableDataChanged();
        s11jTable.setModel(dtm);
        
        //disable save button
        saveS11jButton.setEnabled(false);
        
    }//GEN-LAST:event_clearS11jButtonActionPerformed

    private void malizaBilajButtonActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_malizaBilajButtonActionPerformed
        // TODO add your handling code here:
        if(jobCardS11TextField.getText().length()<1){
            javax.swing.JOptionPane.showMessageDialog(null, "Please first select a job card from the table.",
                    "Caution Message!",
                    javax.swing.JOptionPane.ERROR_MESSAGE);
        }else{
            try{
                java.sql.PreparedStatement ps=connectDB.prepareStatement("UPDATE maintenance.job_card_details SET irq_job_number='NO S11' WHERE job_card_no='"+jobCardS11TextField.getText()+"'");
                ps.executeUpdate();
            
            }
            catch(java.sql.SQLException sqle){
                sqle.printStackTrace();
            }
            
            
            javax.swing.JOptionPane.showMessageDialog(null, "Insert Successful.",
                    "Information Message!",
                    javax.swing.JOptionPane.INFORMATION_MESSAGE);
            
        
            
            clearS11jButton.doClick();
        }
        
        
    }//GEN-LAST:event_malizaBilajButtonActionPerformed
    
    public javax.swing.table.DefaultTableModel s11TableDataModel(String sectAssigned){
        
        sectAssigned=sectionAllocated; 
        
        return com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB," SELECT job_card_no,ed.department,ed.floor,ed.room,ed.subject,section_assigned, date_job_card_created FROM maintenance.job_card_details jcd "
                                                                                                                                +"INNER JOIN maintenance.e1_details ed ON  jcd.e1_id=ed.e1_id " //JOB CARD MUST HAVE EXISTED AS AN E1 DURING IT'S EARLY STAGES
                                                                                                                                +"WHERE jcd.e1_id IN (SELECT e1_id FROM maintenance.e1_approved) "//THE E1 MUST HAVE BEEN APPROVED IN ORDER TO VIEW AS A JOB CARD
                                                                                                                              //  +"AND jcd.with_s11='true' "//MUST DISPLAY ONLY E1's WITH S11s
                                                                                                                                +"AND jcd.with_s11 IS NOT NULL "//GIVES ANY JOB CARD THE CHANCE TO ORDER BY S11 LATER
                                                                                                                                + "AND jcd.irq_job_number='N/A' "//ONLY DISPLAY JOB CARDS WHILE S11 HAS NOT YET BEEN MADE
                                                                                                                                + "AND jcd.expected_duration IS NOT NULL "//MUST HAVE EXPECTED DURATION
                                                                                                                                + "AND jcd.time_instructed IS NOT NULL "//MUST HAVE TIME WHEN OFFICERS WERE ASSIGNED JOB
                                                                                                                                + "AND jcd.completion_worker_username IS NULL "//USERNAME IS NULL LINES ENSURE TABLE DOSE NOT SHOW JOB CARDS ALREADY PAST THIS STAGE
                                                                                                                                + "AND jcd.completion_sender_username IS NULL "
                                                                                                                                + "AND jcd.completion_maintenance_username IS NULL "
                                                                                                                                + "AND section_assigned ILIKE '"+sectAssigned+"' "
                                                                                                                                +"ORDER BY job_card_no");
    }
    
    public javax.swing.table.DefaultTableModel jobCardTableDataModel(String jobCrd,String dept,String subj,String sectAssgn){
        //if(jobCrd.equals(null||dept))
        return com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB," SELECT job_card_no, ed.department,ed.floor,ed.room,ed.subject,section_assigned, date_job_card_created FROM maintenance.job_card_details jcd "
                                                                                                                                +"INNER JOIN maintenance.e1_details ed ON  jcd.e1_id=ed.e1_id " //JOB CARD MUST HAVE EXISTED AS AN E1 DURING IT'S EARLY STAGES
                                                                                                                                +"WHERE jcd.e1_id IN (SELECT e1_id FROM maintenance.e1_approved) "//THE E1 MUST HAVE BEEN APPROVED IN ORDER TO VIEW AS A JOB CARD
                                                                                                                                + "AND ed.registered='true' "//E1 MUST HAVE BEEN REGISTERED
                                                                                                                                +"AND jcd.with_s11 IS NULL "//FILTERS OUT ALREADY PROCESSED JOB CARDS
                                                                                                                                + "AND (job_card_no ILIKE '"+jobCrd+"%' "
                                                                                                                                + "OR department ILIKE '%"+dept+"%' "
                                                                                                                                + "OR subject ILIKE '%"+subj+"%' "
                                                                                                                                + "OR section_assigned ILIKE '%"+sectAssgn+"%') "
                                                                                                                                +"ORDER BY date_job_card_created");
    }
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JTextField buildingS11jTextField;
    private javax.swing.JButton clearS11jButton;
    private javax.swing.ButtonGroup deptRadiosbuttonGroup;
    private javax.swing.JTextField deptS11jTextField;
    private javax.swing.JTextArea descS11jTextArea;
    private javax.swing.JTextField durationS11jTextField;
    private javax.swing.Box.Filler filler10;
    private javax.swing.Box.Filler filler4;
    private javax.swing.Box.Filler filler7;
    private javax.swing.Box.Filler filler8;
    private javax.swing.Box.Filler filler9;
    private javax.swing.JTextField floorS11jTextField;
    private javax.swing.JButton jButton1;
    private javax.swing.JLabel jLabel11;
    private javax.swing.JLabel jLabel12;
    private javax.swing.JLabel jLabel13;
    private javax.swing.JLabel jLabel14;
    private javax.swing.JLabel jLabel15;
    private javax.swing.JLabel jLabel16;
    private javax.swing.JLabel jLabel17;
    private javax.swing.JLabel jLabel18;
    private javax.swing.JLabel jLabel19;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JPanel jobCardS11DetailsjPanel;
    private javax.swing.JTextField jobCardS11TextField;
    private javax.swing.JPanel jobCardS11jPanel;
    private javax.swing.JButton malizaBilajButton;
    private javax.swing.JTextField officialNamesS11jTextField;
    private javax.swing.JTextField roomS11jTextField;
    private javax.swing.JTable s11jTable;
    private javax.swing.JButton saveS11jButton;
    private javax.swing.JTextField subjectS11jTextField;
    private javax.swing.JTabbedPane tabbedPane;
    private javax.swing.JPanel tablePanel;
    private javax.swing.JPanel withS11ActionjPanel;
    // End of variables declaration//GEN-END:variables
}
