/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package com.afrisoftech.accounting;

/**
 *
 * @author SPL7
 */
public class VoteBookBalancesIntfr extends javax.swing.JInternalFrame {

    /**
     * Creates new form VoteBookBalancesIntfr
     */
    java.sql.Connection connectDB = null;
    
    public VoteBookBalancesIntfr(java.sql.Connection connDB) {
        
        connectDB = connDB;
        
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {
        java.awt.GridBagConstraints gridBagConstraints;

        headerPanel = new javax.swing.JPanel();
        financialYearlbl = new javax.swing.JLabel();
        quarterLbl = new javax.swing.JLabel();
        fianacialYearCmbx = new javax.swing.JComboBox();
        quarterCmbx = new javax.swing.JComboBox();
        bodyPanel = new javax.swing.JPanel();
        aieJscrl = new javax.swing.JScrollPane();
        voteBalancesTbl = new javax.swing.JTable();
        buttonPanel = new javax.swing.JPanel();
        saveBtn = new javax.swing.JButton();
        editbtn = new javax.swing.JButton();
        clearBtn = new javax.swing.JButton();
        closeBtn = new javax.swing.JButton();
        helpBtn = new javax.swing.JButton();
        spacerLbl = new javax.swing.JLabel();

        setClosable(true);
        setIconifiable(true);
        setMaximizable(true);
        setResizable(true);
        setTitle("Use this form to set Vote Book balances (Opening Balance)");
        setVisible(true);
        getContentPane().setLayout(new java.awt.GridBagLayout());

        headerPanel.setLayout(new java.awt.GridBagLayout());

        financialYearlbl.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        financialYearlbl.setText("Fianacial Year");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        headerPanel.add(financialYearlbl, gridBagConstraints);

        quarterLbl.setHorizontalAlignment(javax.swing.SwingConstants.CENTER);
        quarterLbl.setText("AIE Reference");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        headerPanel.add(quarterLbl, gridBagConstraints);

        fianacialYearCmbx.setModel(com.afrisoftech.lib.ComboBoxModel.ComboBoxModel(connectDB, "select DISTINCT financial_year FROM ac_aie_allocation ORDER BY financial_year"));
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        headerPanel.add(fianacialYearCmbx, gridBagConstraints);

        quarterCmbx.setModel(com.afrisoftech.lib.ComboBoxModel.ComboBoxModel(connectDB, "select DISTINCT aieno FROM ac_aie_allocation ORDER BY aieno"));
        quarterCmbx.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                quarterCmbxActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        headerPanel.add(quarterCmbx, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        getContentPane().add(headerPanel, gridBagConstraints);

        bodyPanel.setLayout(new java.awt.GridBagLayout());

        voteBalancesTbl.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB, "SELECT serial_no, subhead||'-'||subitem as vote_id, amount as original_vote_amount, 0.00 as vote_balance FROM ac_aie_allocation ORDER BY vote_id"));
        aieJscrl.setViewportView(voteBalancesTbl);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        bodyPanel.add(aieJscrl, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 1;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 500.0;
        getContentPane().add(bodyPanel, gridBagConstraints);

        buttonPanel.setLayout(new java.awt.GridBagLayout());

        saveBtn.setText("Save Vote Balances");
        saveBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                saveBtnActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 1;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        buttonPanel.add(saveBtn, gridBagConstraints);

        editbtn.setText("Edit Vote Balances");
        editbtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                editbtnActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 2;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        buttonPanel.add(editbtn, gridBagConstraints);

        clearBtn.setText("Clear form");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 3;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        buttonPanel.add(clearBtn, gridBagConstraints);

        closeBtn.setText("Colse form");
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 4;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        buttonPanel.add(closeBtn, gridBagConstraints);

        helpBtn.setText("Help");
        helpBtn.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                helpBtnActionPerformed(evt);
            }
        });
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 5;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        buttonPanel.add(helpBtn, gridBagConstraints);
        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 0;
        gridBagConstraints.fill = java.awt.GridBagConstraints.HORIZONTAL;
        gridBagConstraints.weightx = 200.0;
        gridBagConstraints.weighty = 1.0;
        buttonPanel.add(spacerLbl, gridBagConstraints);

        gridBagConstraints = new java.awt.GridBagConstraints();
        gridBagConstraints.gridx = 0;
        gridBagConstraints.gridy = 2;
        gridBagConstraints.fill = java.awt.GridBagConstraints.BOTH;
        gridBagConstraints.weightx = 1.0;
        gridBagConstraints.weighty = 1.0;
        getContentPane().add(buttonPanel, gridBagConstraints);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void helpBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_helpBtnActionPerformed
        // TODO add your handling code here:
    }//GEN-LAST:event_helpBtnActionPerformed

    private void quarterCmbxActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_quarterCmbxActionPerformed

          voteBalancesTbl.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB, "SELECT serial_no, subhead||'-'||subitem as vote_id, amount as original_vote_amount, vote_balance as vote_balance FROM ac_aie_allocation WHERE financial_year = '"+fianacialYearCmbx.getSelectedItem().toString()+"' ORDER BY vote_id"));
         
        // TODO add your handling code here:
    }//GEN-LAST:event_quarterCmbxActionPerformed

    private void saveBtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_saveBtnActionPerformed

        try {
            java.sql.PreparedStatement pstmt = connectDB.prepareStatement("UPDATE ac_aie_allocation SET vote_balance = ? WHERE serial_no = ? AND subhead||'-'||subitem = ?");
            for(int i = 0; i < voteBalancesTbl.getRowCount(); i++){
                if(voteBalancesTbl.getValueAt(i, 0) != null){
                pstmt.setDouble(1, Double.parseDouble(voteBalancesTbl.getValueAt(i, 3).toString()));
                pstmt.setInt(2, Integer.parseInt(voteBalancesTbl.getValueAt(i, 0).toString()));
             //   pstmt.setString(3, fianacialYearCmbx.getSelectedItem().toString());
                pstmt.setString(3, voteBalancesTbl.getValueAt(i, 1).toString());
                pstmt.executeUpdate();
                }
            }
            javax.swing.JOptionPane.showMessageDialog(this, "Data Saved/Updated successfully");
            
        } catch (java.sql.SQLException sqEx){
           
            javax.swing.JOptionPane.showMessageDialog(this, sqEx.getMessage());
            sqEx.printStackTrace();
           //javax.swing.JOptionPane.showMessageDialog(this, sqEx.getMessage());
        }
        // TODO add your handling code here:
    }//GEN-LAST:event_saveBtnActionPerformed

    private void editbtnActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_editbtnActionPerformed

          voteBalancesTbl.setModel(com.afrisoftech.dbadmin.TableModel.createTableVectors(connectDB, "SELECT serial_no, subhead||'-'||subitem as vote_id, amount as original_vote_amount, vote_balance as vote_balance FROM ac_aie_allocation WHERE financial_year = '"+fianacialYearCmbx.getSelectedItem().toString()+"' ORDER BY vote_id"));
 
        // TODO add your handling code here:
    }//GEN-LAST:event_editbtnActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JScrollPane aieJscrl;
    private javax.swing.JPanel bodyPanel;
    private javax.swing.JPanel buttonPanel;
    private javax.swing.JButton clearBtn;
    private javax.swing.JButton closeBtn;
    private javax.swing.JButton editbtn;
    private javax.swing.JComboBox fianacialYearCmbx;
    private javax.swing.JLabel financialYearlbl;
    private javax.swing.JPanel headerPanel;
    private javax.swing.JButton helpBtn;
    private javax.swing.JComboBox quarterCmbx;
    private javax.swing.JLabel quarterLbl;
    private javax.swing.JButton saveBtn;
    private javax.swing.JLabel spacerLbl;
    private javax.swing.JTable voteBalancesTbl;
    // End of variables declaration//GEN-END:variables
}
